<h1 id="vue3">Vue3 狀態管理</h1>
<p>在開發大型 Vue 應用時，我們常常需要一個集中管理和維護應用各個部分狀態的機制。Vuex 就是為了解決這一問題而生的。Vuex 是一個專為 Vue.js 應用程序開發的狀態管理模式和庫。它利用 Vue.js 的細粒度資料響應機制，讓你可以更方便地管理應用的狀態。</p>
<h3 id="vuex">Vuex 簡介</h3>
<p>Vuex 作為一個狀態管理工具，主要解決了組件間的狀態共享問題，保證狀態在多個組件中同步。Vuex 中的狀態存儲是響應式的，當 Vue 組件從 store 中讀取狀態的時候，若狀態發生變化，相關組件也會相應地得到高效更新。</p>
<p>Vuex 的核心概念包括：</p>
<ul>
<li><strong>State</strong>：定義了應用狀態的數據結構，可以在這裡設置默認的初始狀態。</li>
<li><strong>Getters</strong>：允許組件從 Store 中獲取數據，比如過濾出一些數據。</li>
<li><strong>Mutations</strong>：是唯一更改 Store 中狀態的方法，且不能處理異步操作。</li>
<li><strong>Actions</strong>：用於提交 mutation，而不是直接變更狀態，可以包含任意異步操作。</li>
<li><strong>Modules</strong>：允許將單一 Store 分割成多個 Store。</li>
</ul>
<h3 id="vue3vuex">在 Vue3 中設置 Vuex</h3>
<p>Vue3 推出了 Composition API，對於狀態管理也提供了新的使用方式。為了在 Vue3 中使用 Vuex，我們需要安裝 Vuex 的最新版本，這個版本被稱為 Vuex 4，它專為 Vue3 設計。</p>
<ol>
<li>安裝 Vuex：</li>
</ol>
<pre><code class="bash language-bash">   npm install vuex@next --save
</code></pre>
<ol start="2">
<li>創建一個 Vuex store。在你的 Vue 應用的 <code>src</code> 目錄下創建一個 <code>store</code> 目錄，並在這個目錄下創建 <code>index.js</code>：</li>
</ol>
<pre><code class="js language-js">   import { createStore } from 'vuex';

   export default createStore({
     state() {
       return {
         count: 0
       };
     },
     mutations: {
       increment(state) {
         state.count++;
       }
     },
     actions: {
       increment({ commit }) {
         commit('increment');
       }
     },
     getters: {
       doubleCount: state =&gt; state.count * 2,
     }
   });
</code></pre>
<ol start="3">
<li>將 Vuex store 加入到 Vue 應用中，在 <code>main.js</code> 中引入創建的 store，並加入到 Vue 應用實例中：</li>
</ol>
<pre><code class="js language-js">   import { createApp } from 'vue';
   import App from './App.vue';
   import store from './store';

   createApp(App).use(store).mount('#app');
</code></pre>
<h3 id="vuex-1">使用 Vuex 管理狀態</h3>
<p>現在 Vuex 已經設置好了，我們可以在組件中使用 Vuex 的狀態了。以下是一個簡單的例子，展示如何在組件中使用 Vuex 的 state 和 getters：</p>
<pre><code class="vue language-vue">&lt;template&gt;
  &lt;div&gt;
    &lt;p&gt;{{ count }}&lt;/p&gt;
    &lt;p&gt;{{ doubleCount }}&lt;/p&gt;
    &lt;button @click="increment"&gt;Increment&lt;/button&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script&gt;
import { mapState, mapGetters, mapActions } from 'vuex';

export default {
  computed: {
    ...mapState(['count']), // 這裡使用 mapState 輔助函數來使用 state
    ...mapGetters(['doubleCount']), // 使用 mapGetters 輔助函數來使用 getters
  },
  methods: {
    ...mapActions(['increment']), // 使用 mapActions 輔助函數來執行 actions
  },
}
&lt;/script&gt;
</code></pre>
<p>這個例子展示了如何在組件中讀取 Vuex store 中的 <code>state</code> 和 <code>getters</code>，以及如何使用 <code>actions</code> 來提交更改。通過這種方式，我們可以在組件中輕鬆地管理和使用全局狀態。</p>
<h3 id="vuex-2">組件中使用 Vuex 的注意事項</h3>
<p>當在 Vue3 組件中使用 Vuex 時，有幾個重要的實踐要點需要注意：</p>
<ol>
<li><p><strong>組件解耦</strong>: 儘量保持組件與 Vuex store 的解耦，可以透過封裝更多的 getters 或 actions 來實現。這樣做不僅使得組件更容易重用，也讓狀態管理更加清晰。</p></li>
<li><p><strong>使用 Namespaced Modules</strong>: 當應用規模變得很大時，將 store 分割成模塊是很有幫助的。使用 namespaced 模塊可以幫助你更好地組織代碼和避免命名衝突。</p></li>
<li><p><strong>異步操作</strong>: Vuex 的 mutations 只能處理同步操作，對於異步邏輯（例如從 API 獲取數據），應該放在 actions 中處理。</p></li>
<li><p><strong>遵循 Flux 流程</strong>: Vuex 的設計靈感來自 Flux 架構。按照其模式，數據應該保持單向流動，這意味著你應該避免在 mutations 或 actions 之外直接修改 state。</p></li>
<li><p><strong>使用 Composition API</strong>: Vue3 引入的 Composition API 為狀態管理提供了更多的靈活性。對於需要在多個組件共享狀態的情況，考慮使用 Composition API 結合 Vuex 或者 Vue3 的 <code>reactive</code>、<code>ref</code> 等響應式API來管理。</p></li>
</ol>
<p>通過這些最佳實踐，你可以在 Vue3 應用中更高效、更靈活地使用 Vuex 來管理和維護狀態，從而開發出更加可靠和易於維護的應用。</p>
<h2 id="namespacedmodulesdesign">Namespaced Modules Design</h2>
<p>在 Vuex 中使用 namespaced modules 是一種組織大型應用中狀態管理代碼的有效方式。它允許你將 store 分割成模塊，每個模塊擁有自己的 state、mutations、actions 和 getters。這樣做有助於代碼的維護和重用，同時避免了命名衝突。下面我們將通過一個簡單的例子來演示如何在 Vuex 中使用 namespaced modules。</p>
<p>假設我們的 Vue 應用有用戶管理（user）和產品管理（product）兩個功能模塊，我們希望對這些功能進行模塊化管理。</p>
<h3 id="1">步驟 1：創建模塊</h3>
<p>首先，在 <code>store</code> 目錄下為每個模塊創建一個文件，例如 <code>user.js</code> 和 <code>product.js</code>。</p>
<p><strong>store/user.js</strong>:</p>
<pre><code class="javascript language-javascript">export default {
  namespaced: true,
  state: () =&gt; ({
    users: []
  }),
  mutations: {
    addUser(state, user) {
      state.users.push(user);
    }
  },
  actions: {
    addUser({ commit }, user) {
      commit('addUser', user);
    }
  },
  getters: {
    userCount: state =&gt; state.users.length,
  }
};
</code></pre>
<p><strong>store/product.js</strong>:</p>
<pre><code class="javascript language-javascript">export default {
  namespaced: true,
  state: () =&gt; ({
    products: []
  }),
  mutations: {
    addProduct(state, product) {
      state.products.push(product);
    }
  },
  actions: {
    addProduct({ commit }, product) {
      commit('addProduct', product);
    }
  },
  getters: {
    productCount: state =&gt; state.products.length,
  }
};
</code></pre>
<h3 id="2store">步驟 2：將模塊組合到主 store 文件</h3>
<p>然後，在 <code>store/index.js</code> 中導入這些模塊並使用它們：</p>
<pre><code class="javascript language-javascript">import { createStore } from 'vuex';
import user from './user';
import product from './product';

export default createStore({
  modules: {
    user,
    product
  }
});
</code></pre>
<h3 id="3stategettersactions">步驟 3：在組件中使用模塊化的 state、getters、actions</h3>
<p>當你需要在組件中使用這些模塊化的 state、getters 或 actions 時，你需要指定模塊的命名空間。</p>
<p>例如，如果你想在一個組件中使用 <code>user</code> 模塊的 <code>addUser</code> action 和 <code>userCount</code> getter，你可以這樣做：</p>
<pre><code class="vue language-vue">&lt;template&gt;
  &lt;div&gt;
    &lt;button @click="addUser({ name: 'New User' })"&gt;Add User&lt;/button&gt;
    &lt;p&gt;User count: {{ userCount }}&lt;/p&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script&gt;
import { mapActions, mapGetters } from 'vuex';

export default {
  methods: {
    ...mapActions('user', ['addUser']),
  },
  computed: {
    ...mapGetters('user', ['userCount']),
  },
};
&lt;/script&gt;
</code></pre>
<p>使用 <code>namespaced: true</code> 使得模塊具有更好的封裝性和可重用性，同時也讓狀態管理的結構更加清晰。透過將應用分割成不同的模塊，你可以更容易地維護和擴展你的 Vuex store。</p>